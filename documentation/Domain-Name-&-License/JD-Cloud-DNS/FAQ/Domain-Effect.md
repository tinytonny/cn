## **域名生效原理**

域名解析流程涉及节点较多，以www.jdcloud.com为例，简化流程图如下所示：

![域名生效.png](http://img1.jcloudcs.com/cms/57f6ff37-9e3b-49c8-ac9b-04a060f6342f20180301151740.png)

1．用户发起DNS查询请求，携带域名www.jdcloud.com

2．Local DNS接收到DNS解析请求，如果有缓存直接返回

3．Local DNS接收到DNS解析请求，没有缓存，则向根域权威服务器发起请求

4．根域权威服务器返回顶级域com服务器地址

5．Local DNS发送请求到顶级域com服务器，查询jdcloud.com域所属权威服务器

6．顶级域com服务器返回jdcloud.com域所属权威服务器

7．Local DNS发送请求到jdcloud.com权威服务器，即云解析服务器

8．云解析服务器，根据用户通过控制台下发的配置进行解析，返回www.jdcloud.com域名对应IP地址

以上就是简化的完整域名解析流程，客户发起DNS查询请求到Local DNS，Local DNS负责逐级获取解析结果，最终通过云解析获取到所需数据

**域名NS修改生效时间**

域名NS记录只能通过域名注册商修改，修改之后需要同步到根域服务器才能在全网生效，各地同步时间不一致，通常需要24-48小时，超过48小时还未生效，需要联系对应的域名注册商进行定位分析。

**解析记录添加及修改生效流程**

1、 新增解析记录

云解析服务器会快速同步到所有节点，解析配置秒级生效。客户发起DNS请求，由于Local DNS不存在缓存，会直接进行迭代查询，获取到新增解析记录。客户端理论生效时间也是秒级，但是某些Local DNS会在没有缓存的情况下，劫持到自身的广告通知等页面，实际生效时间取决于客户端所在地区Local DNS行为，通常不会超过1个小时。

2、 修改解析记录

云解析服务器也会快速同步到所有节点，解析配置秒级生效。整个域名解析流程各节点均存在缓存，缓存时效按照记录值的TTL进行约束，只有TTL过期之后，Local DNS才会重新进行迭代查询获取新的记录值。理论刷新时间大致与记录TTL保持一致。但是某些Local DNS会修改从权威服务器获取的TTL值，实际刷新时间，取决于客户端配置的Local DNS行为。
