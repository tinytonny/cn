# 配置管理

**前言**

配置管理是DevOps的基础模块，在DevOps中扮演着CMDB的角色，为DevOps其他模块提供各种运维场景的配置数据服务。

配置管理提供服务树结构创建与管理、统一权限控制以及主机导入与分配等基础服务，用户可根据组织的业务架构，轻松地创建和管理应用。

**术语定义**

服务树

服务树是一个可视化拓扑的树结构，存储着业务组织架构信息。一方面，它以JNS服务（名字服务）为支持，按照“部门-产品线-系统-应用-分组-实例”的层级关系维护主机和实例的对应关系，为其他系统提供统一准确的服务数据信息，另一方面， 用户可基于服务树实现角色管理和基于角色的统一权限控制，是DevOps系统的基础。
- 部门：用户可灵活定义并划分部门，如可以是实际组织中的一个二级或三级部门。
- 产品线：产品线是一个完整的产品或服务，如一个部门下可能有多个产品线或业务。
- 系统：系统是一个包含多个应用的集合，可以是一个独立的产品或产品的一个主要分支。
- 应用：应用可以是一个大的功能模块，也可以是一个小的功能点，用户可按实际业务情况进行定义与创建。
- 分组：一个应用可以创建多个不同生产环境或不同用途的分组，分别对每个分组添加机器，进行管理与部署。

资源池

为了更好地管理主机，分配主机，引入了资源池的概念。资源池功能主要的作用是进行主机归属分配，即将主机资源从外部（京东云控制台或者手工）导入到二级部门，再将主机从二级部门分配到具体的产品线。

**产品功能**

1.维护产品线

点击部门名称右边的“ +添加产品线”，即可打开添加产品线页面。点击相应的产品线，即可对其进行编辑和删除，删除时需先删除该产品线的系统。

2.维护系统

点击产品线名称右边的“ +添加系统”，即可打开添加系统页面。点击相应的系统，即可对其进行编辑和删除，删除时需先删除该系统下的所有应用。

3.维护应用

点击系统名称右边的“ +添加应用”，即可打开添加应用页面。

点击相应的应用，即可对其进行编辑和删除，删除时需先删除该应用下的所有分组。

4.导入主机

主机资源包括京东云主机、其他第三方主机（包括物理机、虚机）。如您的账户已经关联京东云控制台账户，且已加入到某产品线的资源池，可使用快速导入的方式直接勾选控制台中的云主机至DevOps平台中用于部署。

方法一：快速导入，服务树中选择需要导入的产品线，点击 快速导入 按钮，在导入页面选择云主机所属地域，选择需要的云主机即可。

方法二：批量导入，服务树中选择需要导入的产品线，根据提供的导入模板正确填写主机信息点击确定即可。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide4.png)

5.维护分组和实例

添加应用时，完成【基本设置】和【角色设置】并保存后，即可对应用添加分组及各分组下的实例，添加的主机可在主机列表页看到。

选择相应的应用，即可在右侧编辑分组和实例，删除分组时须先删除分组下的实例。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide5.png)

具体来说，新增分组： 

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide6.png)

需要填写以下信息：

- 英文名
- 中文名
- 环境：生产/预发
- 支持弹性策略：是/否。即此分组是否支持弹性伸缩，即按照配置好的伸缩策略，对云主机进行扩缩容，并部署对应程序

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;若选择“是”，那么：

  需要填写以下信息：
  - 实例模板：选择在菜单栏-配置管理-规格模板 中，定义好的规格模板
  - 高可用组：否/是
  - 地域：资源所在物理位置
  - 可用区：若选择高可用组为是，那么，这里可多选可用区
  - 计费方式：包年包月/按配置
  - 弹性主机数：分组中的云主机数
  - Tags：
  - 描述：

	若选择“否”，那么：

  需要选择部署主机：选择已有主机/根据您实例模块创建主机，
  
  若选择“选择已有主机”，那么：
  
 ![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide7.png)
 
   需要填写以下信息：
    - Tags：
    - 描述：
    之后进入到编辑实例页面，选择分组，可添加控制台中已创建好的云主机。
    
若选择“根据您实例模块创建主机”，那么：
  ![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide8.png)
需要填写以下信息：
  - 实例模板：选择在菜单栏-配置管理-规格模板 中，定义好的规格模板
  - 高可用组：否/是
  - 可用区：若选择高可用组为是，那么，这里可多选可用区
  - 地域：资源所在物理位置
  - 计费方式：包年包月/按配置
  - 实例数：分组中的云主机数
  - Tags：
  - 描述：


6.资源池

关联主机资源到产品线

从导航栏中，配置管理-资源池

i.方法一：快速导入，在服务树中选择需要导入的产品线，点击“快速导入”按钮，在导入页面选择云主机所属地域，选择需要的云主机即可。

ii.方法二：批量导入，服务树中选择需要导入的产品线，根据提供的导入模板正确填写主机信息点击确定即可。

 ![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide9.png)


7.规格模板

从导航栏中，配置管理-规格模板

支持实例模板、伸缩模板

实例模板如下：
  ![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide10.png)

- 地域：建议您根据所在地理位置选择靠近的地域。可降低访问延迟，提高下载速度
- 镜像：选择京东云控制台中已经存在的镜像
- 配置规格：选择机型配置
- 私有网络：选择京东云控制台中已经存在的私有网络，为虚机分配在私有网络地址范围内的 IP 地址；
- 子网：选择京东云控制台中已经存在的子网子网，为虚机分配在子网络地址范围内的 IP 地址；
- 安全组：选择京东云控制台中已经存在的安全组，安全组具有防火墙的功能，用于设置虚机 CVM 的网络访问控制。
- 带宽计费：固定带宽/按使用流量
- 名称：要创建的模板的名称。
- 密码：设置登录虚机密码，如不设置系统会自动发送初始密码至控制台关联的邮箱中。

创建完成的模板将出现在模板列表中，并可以在后续分组设置中可以选择到。


伸缩模板如下：
   ![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide11.png)
 
- 伸缩策略名称：用于标示这个伸缩策略组。
- 最小伸缩组：指定伸缩组中最少的实例数量
- 最大伸缩数：指定伸缩组中最大的实例数量
- 冷却期：设置冷却期，可以确保在上一伸缩活动生效前不会启动或终止其他实例。伸缩组使用简单的伸缩策略动态伸缩后，会等待冷却时间完成，然后再继续伸缩活动。
- 移出策略：当伸缩组要减少实例且有多个选择时，将根据移出策略来选择移出哪个云主机实例。我们提供两种移出策略，移出最早创建的云主机和移出最新创建的云主机。
- 策略信息：
  目前支持以下指标：
  - CPU空闲率
  - 内存空闲率
  - 网络入速率
  - 网络出速率
  - hawkeye监控
  每个指标可以支持以下维度：
  - 最大值
  - 最小值
  - 平均值
  伸缩规则：扩容/缩容，伸缩指定数量（台）云主机或者指定比例（%）云主机

- 发送通知到：发生伸缩操作时，给指定邮箱发送通知邮件；多个邮箱以分号分隔。
- 当伸缩组发生以下事件时发送通知：扩容、缩容、无法扩容、无法缩容。
