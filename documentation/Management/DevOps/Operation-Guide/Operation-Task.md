# 运维工具

**前言**

运维工具主要包括作业平台和镜像管理，为用户提供基础运维场景服务。

**作业平台**

作业平台为运维工程师提供自动化的脚本执行和文件分发服务，可以有效的提高运维工作效率。作业平台管理模块提供高效的脚本管理和文件分发功能，能够将分布在各个机器的脚本在平台中集中管理起来，做到一处编辑，处处使用。更重要的是，对脚本信息进行修改，在秒级时间内就能够实时通知到所有的机器。

**镜像广场**

基于harbor创建私有化的docker镜像仓库，提供稳定的镜像托管服务，镜像广场包括公共官方镜像及个人镜像。

**产品功能**

**新建脚本**

选择服务树节点后，选择菜单“运维工具—脚本管理”，在脚本列表页点击“新增脚本”，如图所示，支持手动录入或从本地上传脚本，并可设置脚本参数与超时时间。

**执行脚本**

脚本新建完成后，可以通过脚本列表进行执行操作。执行时，可以设置目标主机、执行方式、执行账号等，同时也可以再次修改脚本内容，脚本参数和超时时间（此时的修改只影响本次执行过程，并不对原脚本造成影响），选择执行目标机器时，为了方便提供了直接 “选择服务器“ 和“选择服务树” 两种方式。

设置完成后，点击“执行脚本”即可，在脚本执行页面，点击单台主机可以看到详细的日志输出。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide26.png)
 

**新建文件分发任务**

新建文件分发任务，需先选择左侧服务树对应的节点，文件分发任务创建完成后将归属于该服务树节点。选择服务树节点后，可以点击 “新建任务” 按钮，打开新建任务页面，如图在该页面配置源文件、设置目标路径、目标机器，文件分发支持串并行等多种执行方式，并可设置前后置命令。

**执行文件分发任务**

文件分发任务创建完成后，可以通过任务列表进行执行操作。执行时，可以重新设置源文件、目标目录、目标机器、执行方式、执行账号等（此时的修改只影响本次执行过程），选择执行目标机器时，为了方便提供了直接 “选择服务器“ 和“选择服务树” 两种方式。

设置完成后，点击执行即可以打开详细的执行页面，点击单台主机可以看到详细的日志输出。

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide27.png)

**镜像广场**

用户可选择上传镜像到镜像广场、从镜像广场中下载镜像。

1.推送本地镜像到镜像广场

```
a.列出本地镜像
docker images
b.后台启动容器，验证配置是否正确
docker run -d {镜像名/ID}
docker ps
c.登录镜像仓库
docker login -u{用户名} -p{密码} *.jdcloud.com   #具体域名详见页面提示
返回「Login Succeded」即为登录成功。
d.标记本地镜像
docker tag {镜像名/ID} *.jdcloud.com/{项目名}/{镜像名}:{版本}
e.推送本地镜像到广场
docker push *.jdcloud.com/{项目名}/{镜像名}:{版本}
```

提示：

a.	默认为基础+私有镜像，如果需要更改，请登录镜像广场更改镜像的类型 基础镜像、编译镜像

b.	镜像类型分为两类，分别：

- 基础镜像: 一般指原生的Centos 操作系统，个人可以推送到镜像广场管理和维护
- 编译镜像: 一般指在基础镜像上安装了编译需要的软件，例如（maven jdk gcc等）编译需要的环境镜像，个人可以推送到镜像广场管理和维护


2.从镜像广场中拉取镜像到本地

```
a.公开镜像
docker pull *.jdcloud.com/{项目名}/{标签名}:{版本}
b.私有镜像
# 登录镜像广场
docker login -u{用户名} -p{密码} *.jdcloud.com   #具体域名详见页面提示
# 拉取镜像
docker pull *.jdcloud.com/{项目名}/{标签名}:{版本}
```
